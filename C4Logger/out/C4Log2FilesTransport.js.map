{"version":3,"file":"C4Log2FilesTransport.js","sourceRoot":"","sources":["../src/C4Log2FilesTransport.ts"],"names":[],"mappings":"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","sourcesContent":["import Winston          = require('winston');\nimport C4LogLevel       = require('./C4LogLevels');\nimport C4LoggerOptions  = require('./C4LoggerOptions');\n\nimport C4LogTransportInstance from './C4LogTransportInstance';\n\nexport class C4Log2FilesTransport implements C4LogTransportInstance {\n    protected m_transport   : Winston.TransportInstance | null;\n    private m_CurDate       : string;\n    private m_CurDateCount  : number;\n\n    constructor() {\n        this.m_transport    = null;\n        this.m_CurDate      = '';\n        this.m_CurDateCount = 0;\n    }\n\n    async init(LogConig : C4LoggerOptions.FileLoggerOptions) {\n        let Self : C4Log2FilesTransport = this;\n        this.m_transport    = new Winston.transports.File({\n            name    : LogConig.name,\n            label   : LogConig.label || LogConig.name,\n            filename: LogConig.filename || './logs/default-logs.log',\n            level   : LogConig.level || 'info',\n            maxsize : LogConig.maxsize  || 102400,\n            maxfiles: LogConig.maxfiles || 10,\n            rotationFormat : function() : string {\n                return getForamtteDate();\n\n                function getForamtteDate() : string {\n                    let temp : Date         = new Date();\n                    let dateStr : string    = padStr(temp.getFullYear())\n                        + '-' + padStr(temp.getMonth() + 1)\n                        + '-' + padStr(temp.getDate());;\n                        \n                    Self.m_CurDateCount++;\n                    if (dateStr !== Self.m_CurDate) {\n                        Self.m_CurDate      = dateStr;\n                        Self.m_CurDateCount = 0;\n                    }\n                    return (dateStr + '_' + padStr(Self.m_CurDateCount));\n                }\n\n                function padStr(i : number) : string {\n                    return (i < 10) ? \"0\" + i : \"\" + i;\n                }\n            },\n            timestamp : function() : string {\n                return (new Date()).toISOString();\n            },\n            json : false,\n            formatter : function(options : any) : string {\n                return '[' + options.timestamp() + '] [' + options.level.toUpperCase()\n                    + '] ' + options.label + ' - ' + (options.message ? options.message : '')\n                    + (options.meta && Object.keys(options.meta).length ? '\\n\\t'+ JSON.stringify(options.meta) : '' );\n            },\n            handleExceptions : true,\n            humanReadableUnhandledException : true\n        });\n    }\n\n    changeLevel(Level : C4LogLevel.C4LogLevel) : void {\n        if (null !== this.m_transport) {\n            this.m_transport.level  = Level;\n        }\n    }\n\n    close() {}\n\n    getName() : string {\n        if (null !== this.m_transport) {\n            return this.m_transport.name;\n        }\n        return '';\n    }\n\n    getTransport() {\n        return this.m_transport;\n    }\n}\n"]}